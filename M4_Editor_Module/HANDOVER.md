# 摄颜 (SheYan) M4 编辑模块满血版 — 完整交付清册

**版本:** M4.1.0
**交付日期:** 2026-02-26
**交付方:** Manus AI
**接收方:** SheYan 产品团队

---

## 一、交付概览

本次交付为 SheYan 摄颜 AI 相机 App **M4 编辑模块满血版**的完整设计与架构资产，涵盖 12 张全套纯 UI 设计图、架构审计技术规范、雁宝记忆参数回流逻辑图，以及完整的开发实施指南。所有资产已同步备份至 GitHub 仓库 `Tsaojason-cao/YanbaoCamera-Android`，路径为 `M4_Editor_Module/`。

---

## 二、UI 设计图交付清单（共 12 张）

所有设计图均为**纯 UI 平铺展示**，无手机外框，背景为曜石黑 `#0A0A0A`，分辨率 1536×2752px（竖版）或 2752×1536px（横版），与 V 视觉风格完全一致。

| 编号 | 文件名 | 界面名称 | 覆盖工具 | 尺寸 |
| :---: | :--- | :--- | :--- | :--- |
| 01 | `EDIT_M4_01_main.png` | 编辑主界面 | 全局导航 + 滤镜入口 | 竖版 |
| 02 | `EDIT_M4_02_basic_adjust.png` | 基础调整面板 | 工具 1-4：曝光/对比度/饱和度/亮度 | 竖版 |
| 03 | `EDIT_M4_03_master_filter.png` | 大师模式滤镜 | 91 个滤镜缩略图 + 强度调节 | 竖版 |
| 04 | `EDIT_M4_04_light_shadow.png` | 光影重塑面板 | 工具 5-8：高光/阴影/色温/色调 | 竖版 |
| 05 | `EDIT_M4_05_texture.png` | 质感增强面板 | 工具 9-11：锐化/颗粒/暗角 | 竖版 |
| 06 | `EDIT_M4_05_beauty.png` | 美颜塑形面板 | 皮肤/脸型/五官/亮眼/身材 + 手动修容 | 竖版 |
| 07 | `EDIT_M4_06_ai_erase.png` | AI 消除笔面板 | 工具 14：消除笔 + 局部调色切换 | 竖版 |
| 08 | `EDIT_M4_07_29d.png` | 29D 渲染微调 | 29 维度参数精调（光子反弹/纹理置换等）| 竖版 |
| 09 | `EDIT_M4_08_memory.png` | 雁宝记忆调用 | 一键套用历史参数 + 参数预览卡片 | 竖版 |
| 10 | `EDIT_M4_09_sticker.png` | 雁宝贴纸水印 | 工具 16-17：雁宝贴纸 + 蝴蝶结水印 | 竖版 |
| 11 | `EDIT_M4_10_superres.png` | AI 超分画廊 | 工具 18：2x/4x 超分 + AI 修复 + 对比 | 竖版 |
| 12 | `EDIT_M4_11_crop.png` | 裁剪旋转面板 | 工具 12-13：裁剪旋转 + 透视矫正 | 竖版 |
| 附 | `EDIT_M4_12_memory_flow.png` | 雁宝记忆回流逻辑图 | 5 节点参数闭环流程 | 横版 |

---

## 三、18 个核心工具矩阵 — 完整实现清单

### 3.1 基础调整（工具 1-4）

| 工具 | 参数范围 | 实现方式 | 对应 UI 图 |
| :--- | :--- | :--- | :--- |
| 曝光 | -100 ~ +100 | GPU 亮度乘数 Shader | EDIT_M4_02 |
| 对比度 | -100 ~ +100 | S 曲线 LUT | EDIT_M4_02 |
| 饱和度 | -100 ~ +100 | HSL 色彩空间转换 | EDIT_M4_02 |
| 亮度 | -100 ~ +100 | 线性偏移 Shader | EDIT_M4_02 |

### 3.2 光影重塑（工具 5-8）

| 工具 | 参数范围 | 实现方式 | 对应 UI 图 |
| :--- | :--- | :--- | :--- |
| 高光 | -100 ~ +100 | 亮部遮罩 + 曲线压制 | EDIT_M4_04 |
| 阴影 | -100 ~ +100 | 暗部遮罩 + 曲线提升 | EDIT_M4_04 |
| 色温 | -100 ~ +100 | 蓝橙通道混合 LUT | EDIT_M4_04 |
| 色调 | -100 ~ +100 | 绿洋红通道混合 LUT | EDIT_M4_04 |

### 3.3 质感增强（工具 9-11）

| 工具 | 参数范围 | 实现方式 | 对应 UI 图 |
| :--- | :--- | :--- | :--- |
| 锐化 | 0 ~ 100 | Unsharp Mask + 高频增强 | EDIT_M4_05 |
| 颗粒 | 0 ~ 100 | 柏林噪声纹理叠加 | EDIT_M4_05 |
| 暗角 | 0 ~ 100 | 径向渐变遮罩 | EDIT_M4_05 |

### 3.4 构图修改（工具 12-13）

| 工具 | 功能 | 比例支持 | 对应 UI 图 |
| :--- | :--- | :--- | :--- |
| 裁剪旋转 | 自由裁剪 + 旋转 ±45° | 自由/原始/1:1/4:3/3:4/16:9/9:16 | EDIT_M4_11 |
| 透视矫正 | 水平/垂直梯形矫正 | 空间拉伸 + 自动填充 | EDIT_M4_11 |

### 3.5 高级特技（工具 14-15）

| 工具 | 功能 | AI 能力 | 对应 UI 图 |
| :--- | :--- | :--- | :--- |
| 消除笔 | 涂抹消除路人/杂物 | 内容感知填充 + 皮肤纹理重建 | EDIT_M4_06 |
| 局部调色 | 针对特定颜色 HSL 调节 | AI 颜色区域识别 + 遮罩生成 | EDIT_M4_06 |

### 3.6 IP 元素（工具 16-17）

| 工具 | 功能 | 资产规格 | 对应 UI 图 |
| :--- | :--- | :--- | :--- |
| 雁宝贴纸 | 矢量 IP 贴纸放置 | SVG 矢量 + 大小/透明度/旋转 | EDIT_M4_09 |
| 蝴蝶结水印 | 品牌水印叠加 | 矢量蝴蝶结 + 位置/透明度 | EDIT_M4_09 |

### 3.7 画质增强（工具 18）

| 工具 | 功能 | 档位 | 对应 UI 图 |
| :--- | :--- | :--- | :--- |
| AI 超分画廊 | AI 像素级重构 | 2x(4K) / 4x(8K,VIP) / AI修复 | EDIT_M4_10 |

---

## 四、雁宝记忆 Memory Sync — 参数闭环规范

### 4.1 参数序列化格式（XMP 元数据）

编辑完成后，所有参数将以如下 JSON 结构序列化，并写入图片 XMP 元数据的 `SheYan:EditParams` 字段：

```json
{
  "sheyan_version": "M4.1",
  "edit_stack": [
    { "tool_id": "exposure",       "params": { "value": 15 } },
    { "tool_id": "contrast",       "params": { "value": 20 } },
    { "tool_id": "master_filter",  "params": { "filter_id": "film_05", "intensity": 75 } },
    { "tool_id": "beauty_skin",    "params": { "smooth": 60, "whiten": 45, "tone": 30 } },
    { "tool_id": "render_29d",     "params": { "photon_bounce": 65, "scatter": 40, "edge": 30 } },
    { "tool_id": "vignette",       "params": { "intensity": 45 } }
  ]
}
```

### 4.2 存入与调用逻辑

**存入流程（编辑后保存）：**

1. 用户点击"导出"或"保存"
2. 系统将 `edit_stack` 序列化为 JSON 字符串
3. 使用 ExifInterface / XMP 库将 JSON 写入图片 `SheYan:EditParams` 字段
4. 生成新图片存入相册
5. 触发 Git 推送，将参数 JSON 同步至 `M4_Editor_Module/params_backup/` 目录

**调用流程（编辑前套用）：**

1. 用户在相册选择图片进入编辑
2. 系统读取图片 XMP 元数据，检测 `SheYan:EditParams` 字段
3. 若存在历史参数，弹出"雁宝记忆"底部弹窗（`EDIT_M4_08_memory.png`）
4. 用户点击"一键套用此片参数"
5. 系统按 `edit_stack` 顺序，将所有工具参数应用至当前图片的渲染管线

### 4.3 Git 备份目录结构

```
YanbaoCamera-Android/
└── M4_Editor_Module/
    ├── UI_Designs/          # 12 张纯 UI 设计图
    ├── Architecture/        # 架构审计文档 + 设计规范
    ├── params_backup/       # 用户编辑参数 JSON 备份（自动同步）
    └── HANDOVER.md          # 本交接清册
```

---

## 五、满血审查指令 — 官方回答

### Q1：参数冗余性（叠加参数序列化方案）

当用户叠加使用 5 个基础工具 + 1 个大师滤镜时，系统采用**有序操作栈（Ordered Edit Stack）**进行序列化。操作顺序被严格记录，因为渲染顺序直接影响最终视觉效果（先锐化后加颗粒 ≠ 先加颗粒后锐化）。所有参数以 JSON 格式存入图片 XMP 元数据的自定义 `SheYan` 命名空间，并同步 Git 备份。相机模块调用时，按照 `edit_stack` 数组的严格顺序重放所有操作，实现 1:1 精确复刻。

### Q2：性能优化（实时预览缓存策略）

| 场景 | 策略 |
| :--- | :--- |
| 91 个滤镜预览 | 首次进入时后台异步预渲染全部缩略图并缓存；用户停止滑动后才触发高清实时渲染 |
| 滤镜强度调节 | GPU Shader 中的 `mix()` 线性插值，仅改变一个 uniform 变量，接近零延迟 |
| 29D 渲染调节 | 拖动时使用低精度近似模型 + 降分辨率预览；停止拖动后 100ms 延迟触发完整渲染 |
| 美颜塑形 | 液化网格变形在 GPU 上实时计算；AI 检测结果缓存，不重复推理 |

### Q3：对标承诺（手动修容算法）

SheYan M4 美颜塑形模块将提供**等同于 FaceApp / Meitu / Facetune 核心水准**的手动修容能力，具体包括：

- **200+ 关键点 AI 人脸检测**：实时追踪五官、脸部轮廓、皮肤区域
- **GPU 液化变形**：基于网格变形算法实现推脸、手动瘦身，效果平滑自然
- **内容感知填充**：祛痘/消除笔使用 AI 分析周围纹理，无缝填充，无"假皮"感
- **皮肤纹理重建**：填充后自动重建符合真实感的皮肤纹理细节

---

## 六、视觉规范速查

| 规范项 | 数值/色值 |
| :--- | :--- |
| 主背景色 | 曜石黑 `#0A0A0A` |
| 品牌强调色 | 粉色 `#EC4899` |
| 激励/进度色 | 胡萝卜橙 `#F97316` |
| 控制面板背景 | `rgba(45,45,45,0.92)` + 40dp 高斯模糊 |
| 预览区占比 | 上方 72% |
| 控制面板占比 | 下方 28% |
| 滑块 Thumb | 胡萝卜形状（橙色 `#F97316`） |
| 数值气泡 | 粉色圆角矩形，显示于 Thumb 上方 |
| 雁宝 IP | 黑色兔耳角色，粉色蝴蝶结，黑色 JK 制服 |
| 底部导航 | 深灰胶囊形，中心粉色熊掌按钮（突出） |

---

## 七、Git 同步记录

| 仓库 | 路径 | 状态 |
| :--- | :--- | :--- |
| `Tsaojason-cao/YanbaoCamera-Android` | `M4_Editor_Module/UI_Designs/` | ✅ 已推送 |
| `Tsaojason-cao/YanbaoCamera-Android` | `M4_Editor_Module/Architecture/` | ✅ 已推送 |

**Commit 信息:** `feat(M4): Add SheYan M4 Editor Module full UI designs (12 screens) + Architecture Audit + Memory Sync specs`

---

## 八、下一步建议

本次 M4 交付完成后，建议按以下顺序推进开发：

1. **Android 端 UI 实现**：基于 12 张设计图，在 `YanbaoCamera-Android` 项目中实现 M4 编辑模块的 Jetpack Compose UI 层
2. **XMP 参数读写集成**：集成 `androidx.exifinterface` 或 `XmpCore` 库，实现 `SheYan:EditParams` 字段的读写
3. **GPU 渲染管线搭建**：基于 OpenGL ES 3.0 / Vulkan 实现 18 个工具的着色器
4. **AI 模型集成**：接入人脸关键点检测模型（MediaPipe / 自研）和内容感知填充模型
5. **雁宝记忆闭环测试**：端到端测试"相机拍摄 → 编辑修图 → 参数回流"完整链路

---

*本文档由 Manus AI 自动生成，版权归 SheYan 产品团队所有。*
